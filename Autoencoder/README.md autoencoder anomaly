ğŸš¨ Susnata's Autoencoder-Based Anomaly Detection (Credit Card Fraud)
Unsupervised Deep Learning | High Recall | Reconstruction-Error Based

This project uses a Deep Autoencoder to detect anomalies (fraudulent credit-card transactions) using reconstruction error.
The dataset is already PCA-transformed & standardized, making it perfect for an autoencoder to learn only the structure of â€œnormalâ€ transactions.

ğŸ§  Why Autoencoder for Fraud?
Think of the autoencoder as a sigma lone wolf ğŸº â€”
It learns what normal looks like extremely wellâ€¦
So whenever a weird transaction appears ğŸ‘€ â†’
It fails to reconstruct it â†’ giving high reconstruction loss â†’ marking it as fraud.

ğŸ“ 1. Dataset Loading
import pandas as pd
import numpy as np

path = "/content/drive/MyDrive/creditcardAutoencoder.csv"
df = pd.read_csv(path)

df.head()
âœ‚ï¸ 2. Preprocessing
We drop columns not needed by the model and split the data.

X = df.drop(["Class","Time","Amount"], axis=1).values
y = df["Class"].values

print("X shape:", X.shape)
print("y shape:", y.shape)
ğŸ” Trainâ€“Test Split
from sklearn.model_selection import train_test_split

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

X_train_normal = X_train[y_train == 0]
ğŸ—ï¸ 3. Autoencoder Architecture
A simple bottleneck autoencoder:

from tensorflow.keras import layers, models

input_dim = X_train.shape[1]      # 28 features
encoding_dim = 14
bottleneck = 7

encoder = models.Sequential([
    layers.Input(shape=(input_dim,)),
    layers.Dense(encoding_dim, activation="relu"),
    layers.Dense(bottleneck, activation="relu")
])

decoder = models.Sequential([
    layers.Dense(encoding_dim, activation="relu"),
    layers.Dense(input_dim, activation="sigmoid")
])

inputs = layers.Input(shape=(input_dim,))
encoded = encoder(inputs)
decoded = decoder(encoded)

autoencoder = models.Model(inputs, decoded)
autoencoder.compile(optimizer="adam", loss="mse")

autoencoder.summary()
ğŸ‹ï¸â€â™‚ï¸ 4. Training
Only normal transactions (Class = 0) are used for training.

history = autoencoder.fit(
    X_train_normal,
    X_train_normal,
    epochs=20,
    batch_size=256,
    validation_split=0.2,
    shuffle=True
)
ğŸ“‰ 5. Reconstruction Error
ğŸ”¹ Training MSE
reconstructions = autoencoder.predict(X_train_normal)
train_mse = np.mean(np.square(X_train_normal - reconstructions), axis=1)
round(np.mean(train_mse), 2)
ğŸ”¹ Testing MSE
reconstructions_test = autoencoder.predict(X_test)
test_mse = np.mean(np.square(X_test - reconstructions_test), axis=1)
ğŸšï¸ 6. Set Anomaly Threshold (95th Percentile)
threshold_95 = np.percentile(train_mse, 95)
print("95th percentile threshold:", threshold_95)
ğŸš¨ 7. Detect Anomalies
anomalies = test_mse > threshold_95
print("Total anomalies detected:", anomalies.sum())
ğŸ“Š 8. Model Evaluation
Using confusion matrix and classification report:

from sklearn.metrics import confusion_matrix, classification_report

cm = confusion_matrix(y_test, anomalies)
print(cm)

print(classification_report(y_test, anomalies, digits=4))
â­ Key Result
Fraud Recall = ~88% ğŸ˜®ğŸ”¥
High recall is CRITICAL in anomaly detection.
ğŸ’¾ 9. Save the Model
autoencoder.save("/content/drive/MyDrive/final_autoencoder_model.h5")
ğŸ“¤ 10. Export Detected Anomalies
anomalies_df = pd.DataFrame(
    X_test[anomalies],
    columns=df.drop(["Class","Time","Amount"], axis=1).columns
)
anomalies_df["True_Class"] = y_test[anomalies]

anomalies_df.to_csv("/content/drive/MyDrive/detected_anomalies.csv", index=False)
ğŸ§ª 11. Inference Example
from tensorflow.keras.models import load_model

autoencoder = load_model("/content/drive/MyDrive/final_autoencoder_model.h5", compile=False)

new_data = np.random.randn(5, 28)
recon = autoencoder.predict(new_data)
mse = np.mean((new_data - recon)**2, axis=1)

threshold = 1.79  # same threshold used earlier
anomalies = mse > threshold
print(anomalies)
ğŸ† Final Notes
âœ” Autoencoder trained ONLY on normal transactions
âœ” Fraud detected via reconstruction error
âœ” Threshold tuned using percentile method
âœ” Achieved 88% Recall on Fraud Class â€” excellent for anomaly detection
âœ” Model saved + anomaly export included

ğŸº By Susnata